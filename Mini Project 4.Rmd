---
title: "Logistic Regression - Predicting Diabetes Diagnosis"
author: "Adetomilola Adedayo"
subtitle: "Date: May 15, 2023"
output: html_document
---
## Data Cleaning/Preparation

In order to complete this analysis, the data first needed to be cleaned and prepared. The diabetes.csv was imported and loaded into a dataframe object called "diabetes". A new variable called "height.si", which is height in SI units (meters), was created by multiplying the value of the variable "height" by 0.2504. Weight was also converted to SI units (kilograms) by multiplying the "weight" variable by 0.453592. A new variable called "bmi", which represents Body Mass Index (BMI), was calculated using the two new variables height.si and weight.si in this formula: BMI = (weight.si)/(height.si2). "Bmi_categorized" is a categorical variable that was created to categorize BMI into one of four categories: underweight, normal, overweight, and obese, based on the value of "bmi". No other new variables were added to the diabetes dataset, however, more variables were changed. The "insurance" variable was recoded so that the numeric values were changed to their labels, 0 values became "none", 1 values became "government", and 2 values became "private". The same was done to the smoking variable where 1 values became "current", 2 values became "never", and 3 values became "ex-smoker".

```{r warning=FALSE, message=FALSE, results="hide"}
# load libraries
library(Hmisc)
library(dplyr)
library(ggplot2)
library(RNHANES)
library(tidyverse)

# import diabetes.csv file
diabetes <- read.csv("diabetes.csv")

# create new variable height.si 
diabetes <- mutate(diabetes, height.si = height*0.0254)

# check new variable
heightcheck <- select(diabetes, height, height.si)
head(heightcheck)

# create new variable weight.si
diabetes <- mutate(diabetes, weight.si = weight*0.453592)

# check new variable 
weightcheck <- select(diabetes, weight, weight.si)
head(weightcheck)

# calculate BMI 
diabetes <- mutate(diabetes, bmi = (diabetes$weight.si)/(diabetes$height.si^2))

# create categorical variable bmi_categorized
diabetes <- mutate(diabetes, bmi_categorized = ifelse(bmi < 18.5, "underweight",
                                                  ifelse(bmi >= 18.5 & bmi <= 25, "normal",
                                                  ifelse(bmi > 25 & bmi <= 30, "overweight",
                                                  ifelse(bmi > 30, "obese", 
                                                         NA)))))
# check categories in bmi_categorized
table(diabetes$bmi, diabetes$bmi_categorized)

# recode insurance variable and check recode
diabetes <- mutate(diabetes, insurance = ifelse(insurance == 0, "none",
                                            ifelse(insurance == 1, "government",
                                            ifelse(insurance == 2, "private", 
                                                   NA))))
table(diabetes$insurance)

# recode smoking variable and check recode 
diabetes <- mutate(diabetes, smoking = ifelse(smoking == 1, "current",
                                            ifelse(smoking == 2, "never",
                                            ifelse(smoking == 3, "ex-smoker", 
                                                   NA))))
table(diabetes$smoking)

```


## Exploratory Data Analysis
Exploratory data analysis was conducted in order to better understand the data included in the diabetes dataset.     
    In this dataset, there are 403 observations.    
    38.287154 percent of individuals in this dataset are obese.      
    58.06452 percent of individuals in this dataset are female.    
    15.38462 percent of individuals in this dataset have diabetes.    
    The average age of individuals in this dataset is 46.85112 years.    
    The average BMI of individuals in this dataset is 28.7874.    

```{r warning=FALSE, message=FALSE, results="hide"}
# number of observations 
nrow(diabetes)

# percentages of bmi categories
prop.table(table(diabetes$bmi_categorized))*100

# percentage of each gender
prop.table(table(diabetes$gender))*100

# percentage of diabetes status
prop.table(table(diabetes$dm))*100

# average age of patients
mean(diabetes$age, na.rm = T)

# average bmi of patients
mean(diabetes$bmi, na.rm = T)

```


## Data Visualization

Below are a few visualizations describing the data in the diabetes dataset. Figure 1 depicts the frequency of insurance types, the different categories of the "insurance" variable: none, government, and private. From this bar chart, it is evident that government insurance is the most common type of insurance in this dataset, and having no insurance is the least common. Figure 2 is the same type of graph as Figure 1, but depicts the frequency of the different smoking status categories: current, ex-smoker, and never. Never smoked seems to be the most common smoking status in this dataset, followed by current smoker, and then ex-smoker. Figure 3 shows the relationship between Body Mass Index (BMI) and cholesterol level of patients with a scatter plot including a trendline. The trendline suggests a very slight positive relationship between the two variables. The correlation coefficient was calculated to be 0.08593146, which is only slightly slightly greater than 0 and confirms there is only a weak positive correlation between BMI and cholesterol level in this dataset. Figure 4 is a histogram showing the distribution of the age of patients in this dataset. The shape can be described as skewed right since most of the observations are on the left side of the graph. There is a peak for frequency of observations around and between 37 years and 42 years, with almost 50 observations.  

```{r warning=FALSE, message=FALSE}
# frequency of categories in insurance variable using a bar plot
ggplot(data = diabetes) + aes(x = insurance) +  geom_bar(fill="purple") + 
   labs(title="Figure 1. Frequency of Insurance Types", x="Insurance Type", y="Frequency") + theme(plot.title = element_text(hjust = 0.5))

# frequency of categories in smoking variable using a bar plot
ggplot(data = diabetes) + aes(x = smoking) +  geom_bar(fill = "violet") + 
   labs(title = "Figure 2. Frequency of Smoking Status Categories", x = "Smoking Status", y = "Frequency") + theme(plot.title = element_text(hjust = 0.5))

# scatter plot of BMI vs cholesterol 
ggplot(data = diabetes) + aes(x = bmi, y = chol) +  geom_point() + geom_smooth(method = lm) +
   labs(title = "Figure 3. Relationship Between Body Mass Index (BMI) and Cholesterol Level", x = "Body Mass Index (BMI)", y = "Cholesterol Level") + theme(plot.title = element_text(hjust = 0.5))

# calculate correlation coefficient of bmi and cholesterol
cor.test(diabetes$bmi, diabetes$chol, method = "pearson", conf.level = 0.95)

# histogram of age variable 
ggplot(data = diabetes) + aes(x = age) +  geom_histogram(fill = "pink", color = "black", binwidth = 5) +
   labs(title = "Figure 4. Distribution of Age of Patients", x = "Age (in Years)") + theme(plot.title = element_text(hjust = 0.5))
```

## Logistic Regression Results

The slope coefficients for age, BMI, and gender allow us to understand how these predictors impact the outcome, which is having diabetes.

* A 1-year increase in age causes the log odds of having diabetes to increase by 0.055454, holding the other independent variables constant.
* A 1-unit increase in BMI causes the log odds of having diabetes to increase by 0.073879, holding the other independent variables constant. 
* A change in gender from female to male increases the log of the odds of having diabetes by 0.244852, holding the other independent variables constant. 

```{r warning=FALSE, message=FALSE, results="hide"}
# logical regression 
diabetes_lr <- glm(dm ~ age + bmi + gender, data = diabetes, family = "binomial")

# get details of logical regression
summary(diabetes_lr)

```



